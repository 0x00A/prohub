var dom = require('dom-events');
var classList = require('class-list');
var insertcss = require('insert-css');
var q = require('hyperquest');

module.exports = function(stream) {

  insertcss(require('./styles/index.styl'));

  var debounce;

  var addBtn = document.querySelector('.add');
  var loginBtn = document.querySelector('.login');
  var closeBtn = document.querySelector('.modal-close');
  var okBtn = document.querySelector('.modal-ok');
  var projectInput = document.querySelector('.project-name');
  var responseP = document.querySelector('.response p');
  var addModal = document.querySelector('.modal');
  var addModalCL = classList(addModal);
  var unauthorizedP = document.querySelector('.unauthorized p');

  dom.on(loginBtn, 'click', function() {
    location.pathname = '/login';
  });

  dom.on(addBtn, 'click', function() {
    return addModalCL.add('modal-show');
  });

  dom.on(closeBtn, 'click', function() {
    return addModalCL.remove('modal-show');
  });

  dom.on(okBtn, 'click', function() {

    if (projectInput.value == '') {
      responseP.innerText = 'Must have a name';
      return;
    }

    stream.write({
      page: 'home',
      addProject: projectInput.value
    });
  });

  stream.on('json', function(data) {
    if (data.addProject) {
      if (data.addProject.error) {
        responseP.innerText = data.addProject.error;
        return;
      }
      location.reload();
    }

    if (data.error) {
      unauthorizedP.innerText = data.error;
    }
  });
};

