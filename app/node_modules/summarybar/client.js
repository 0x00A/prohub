var template = require('./templates/index.jade');
var insertcss = require('insert-css');

function total(projects, filters) {

  insertcss(require('./styles/index.styl'));

  var totals = {
    issues: 0,
    milestones: 0,
    contributors: 0,
    contributions: 0,
    repos: filters && filters.length || Object.keys(projects).length
  };

  for (var repo in projects) {

    if (filters && filters.length && filters.indexOf(repo) == -1) {
      continue;
    }
    var issues = projects[repo].issues;
    var contribs = projects[repo].contributors;
    var milestones = projects[repo].milestones;

    totals.issues += issues.length;
    totals.milestones += milestones.length;
    totals.contributors += contribs.length;

    for (var i = 0; i < contribs.length; i++) {
      totals.contributions += contribs[i].total;
    }
  }

  return totals;
}

module.exports = function update(data, filters) {
  document.querySelector('.summarybar').innerHTML = 
    template(total(data, filters));
};

