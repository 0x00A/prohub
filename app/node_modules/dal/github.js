var GitHubApi = require('github-cache');
var ASSERT = require('assert').ok;

var github = new GitHubApi({
    // required
    version: '3.0.0',
    // optional
    debug: true,
    protocol: 'https',
    timeout: 5000
});

function auth(token) {
  github.authenticate({
    type: 'oauth',
    token: token.access_token
  });
}

exports.getOrg = function(token, opts, cb) {
  ASSERT(token);
  ASSERT(opts.org);
  auth(token);
  github.orgs.get({org: opts.org}, cb);
};

exports.getRepositories = function(token, opts, cb) {
  ASSERT(token);
  ASSERT(opts.org);
  auth(token);
  github.repos.getFromOrg({org: opts.org, per_page: 100}, cb);
};

exports.getCurrentUser = function(token, opts, cb) {
  ASSERT(token);
  auth(token);
  github.user.get({}, cb);
};


